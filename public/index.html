<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
  <title>CE Strike 3D</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Share+Tech+Mono&display=swap');

    /* ══════════════════════════════════════════════
       DESIGN TOKENS
       All sizes use CSS variables so one change
       propagates everywhere.
    ══════════════════════════════════════════════ */
    :root {
      --c1: #00e5ff;
      --c2: #ff6b35;
      --c3: #b5ff4d;
      --dark: #060810;

      /* iOS safe-area insets */
      --sat: env(safe-area-inset-top,    0px);
      --sar: env(safe-area-inset-right,  0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left,   0px);

      /* Touch button sizes — scale with viewport height so they
         fit both a 375px iPhone and a 1024px iPad */
      --fire-sz:   clamp(58px, 9.5vh, 84px);
      --reload-sz: clamp(46px, 7.5vh, 68px);
      --jump-sz:   clamp(40px, 6.5vh, 56px);
      --joy-sz:    clamp(120px,19vh,  156px);
      --joy-knob:  clamp(42px,  7vh,  58px);

      /* Edge padding from screen borders */
      --er: calc(var(--sar) + clamp(10px,1.8vw,22px));
      --eb: calc(var(--sab) + clamp(8px, 1.5vh,18px));
      --el: calc(var(--sal) + clamp(8px, 1.5vw,18px));
      --et: calc(var(--sat) + clamp(6px, 1.0vh,12px));
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    html, body {
      width:100%; height:100%; overflow:hidden;
      background:#000; color:#fff;
      font-family: 'Rajdhani', sans-serif;
      user-select:none; -webkit-user-select:none;
      overscroll-behavior:none;
      /* Fixes iOS rubber-band scroll and address-bar resize */
      position:fixed; top:0; left:0;
      touch-action:none;
    }

    /* ══════════════════════════════════════════════
       LOBBY
    ══════════════════════════════════════════════ */
    #lobby {
      position:fixed; inset:0; z-index:100;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      background:radial-gradient(ellipse at 50% 40%,#0a1628,#060810);
      padding: calc(var(--sat)+6px) calc(var(--sar)+10px)
               calc(var(--sab)+6px) calc(var(--sal)+10px);
    }
    .lobby-grid-bg {
      position:absolute; inset:0; pointer-events:none;
      background-image:
        linear-gradient(rgba(0,229,255,.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,229,255,.04) 1px, transparent 1px);
      background-size:50px 50px;
      animation:gridMove 12s linear infinite;
    }
    @keyframes gridMove { to { background-position:50px 50px; } }

    #lobby-inner {
      position:relative; z-index:2;
      display:flex; flex-direction:column; align-items:center;
      width:100%; max-width:840px;
      padding: clamp(6px,1.2vh,16px) 12px;
      max-height:100vh; overflow-y:auto;
    }

    .logo {
      font-weight:700;
      font-size: clamp(24px, 5.5vw, 64px);
      letter-spacing: clamp(3px, .8vw, 9px);
      background: linear-gradient(135deg,#fff 20%,var(--c1) 60%,var(--c2) 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      animation:logoPulse 3s ease-in-out infinite;
    }
    @keyframes logoPulse {
      0%,100% { filter: drop-shadow(0 0 16px rgba(0,229,255,.3)); }
      50%      { filter: drop-shadow(0 0 38px rgba(0,229,255,.7)); }
    }
    .logo-sub {
      font-family:'Share Tech Mono',monospace;
      font-size: clamp(7px,1.1vw,10px);
      color:var(--c2); letter-spacing:clamp(2px,.6vw,5px);
      margin-bottom: clamp(7px,1.4vh,24px);
    }
    #name-input {
      background:rgba(0,229,255,.05); border:1px solid rgba(0,229,255,.4);
      color:#fff; font-family:'Share Tech Mono',monospace;
      font-size:clamp(11px,1.4vw,15px);
      padding:clamp(6px,.9vh,10px) 14px;
      margin-bottom:clamp(6px,1.1vh,16px);
      outline:none; width:min(360px,88vw); text-align:center;
      transition:all .2s;
    }
    #name-input:focus {
      border-color:var(--c1); background:rgba(0,229,255,.08);
      box-shadow:0 0 14px rgba(0,229,255,.2);
    }
    .char-grid {
      display:grid; grid-template-columns:repeat(5,1fr);
      gap:clamp(4px,.6vw,8px); width:100%;
      margin-bottom:clamp(6px,1.1vh,18px);
    }
    .char-card {
      cursor:pointer; border:1px solid #1a2040;
      padding:clamp(4px,.7vh,9px) clamp(3px,.4vw,5px);
      text-align:center; background:rgba(255,255,255,.02);
      transition:all .15s; position:relative; overflow:hidden;
    }
    .char-card::before {
      content:''; position:absolute; inset:0;
      background:linear-gradient(135deg,transparent 60%,rgba(255,255,255,.03));
    }
    .char-card.selected {
      border-color:var(--c1); background:rgba(0,229,255,.07);
      box-shadow:0 0 12px rgba(0,229,255,.2);
    }
    .char-swatch {
      width:clamp(20px,2.8vw,36px); height:clamp(20px,2.8vw,36px);
      margin:0 auto clamp(3px,.4vh,6px); border-radius:3px; position:relative;
    }
    .char-swatch::after {
      content:''; position:absolute; inset:0;
      background:linear-gradient(135deg,rgba(255,255,255,.3),transparent); border-radius:3px;
    }
    .char-name { font-size:clamp(7px,.9vw,9px); font-weight:700; letter-spacing:1px; margin-bottom:2px; }
    .char-role { font-size:clamp(6px,.8vw,8px); color:#666; margin-bottom:clamp(2px,.3vh,5px); font-family:'Share Tech Mono',monospace; }
    .stat-row  { display:flex; align-items:center; gap:3px; margin-bottom:2px; }
    .stat-lbl  { font-size:7px; color:#555; width:20px; font-family:'Share Tech Mono',monospace; }
    .stat-bg   { flex:1; height:3px; background:#0a0c18; border-radius:2px; overflow:hidden; }
    .stat-fill { height:100%; border-radius:2px; }

    #btn-play {
      background:linear-gradient(135deg,var(--c1),#0088aa);
      color:#000; border:none; font-family:'Rajdhani',sans-serif;
      font-weight:700; font-size:clamp(12px,1.6vw,16px);
      padding:clamp(7px,1vh,11px) clamp(20px,3vw,42px);
      cursor:pointer; letter-spacing:3px;
      clip-path:polygon(10px 0%,100% 0%,calc(100% - 10px) 100%,0% 100%);
      transition:all .15s;
    }
    #btn-play:hover  { background:linear-gradient(135deg,var(--c2),#aa3300); transform:scale(1.04); }
    #btn-play:disabled { background:#1a2030; color:#333; cursor:not-allowed; transform:none; }

    /* ══════════════════════════════════════════════
       CANVAS
    ══════════════════════════════════════════════ */
    #cvs { display:none; position:fixed; inset:0; width:100%; height:100%; touch-action:none; }

    /* ══════════════════════════════════════════════
       CROSSHAIR
    ══════════════════════════════════════════════ */
    #crosshair {
      display:none; position:fixed; z-index:20; pointer-events:none;
      top:50%; left:50%; transform:translate(-50%,-50%);
      width:18px; height:18px;
    }
    #crosshair::before, #crosshair::after { content:''; position:absolute; background:rgba(255,255,255,.85); }
    #crosshair::before { width:2px; height:100%; left:50%; transform:translateX(-50%); }
    #crosshair::after  { height:2px; width:100%; top:50%; transform:translateY(-50%); }
    .ch-dot { position:absolute; width:3px; height:3px; background:#fff; border-radius:50%; top:50%; left:50%; transform:translate(-50%,-50%); }

    /* ══════════════════════════════════════════════
       HUD  (desktop defaults — mobile overrides below)
    ══════════════════════════════════════════════ */
    #hud {
      display:none; position:fixed; inset:0;
      pointer-events:none; z-index:15;
      font-family:'Share Tech Mono',monospace;
    }

    /* ── Kill counter — top-left ── */
    #kills-display {
      position:absolute;
      top: var(--et);
      left: var(--el);
      background:rgba(6,8,16,.9);
      border:1px solid rgba(255,107,53,.3); border-left:3px solid var(--c2);
      padding:clamp(4px,.7vh,8px) clamp(7px,1vw,12px);
    }
    #kills-val  { font-size:clamp(16px,2.8vh,24px); font-weight:700; color:var(--c2); font-family:'Rajdhani',sans-serif; line-height:1; }
    #kills-lbl  { font-size:clamp(5px,.8vh,8px); color:#555; letter-spacing:2px; }
    #kills-goal { font-size:clamp(5px,.8vh,8px); color:#333; }

    /* ── Scoreboard — top-right ── */
    #scoreboard {
      position:absolute;
      top: var(--et);
      right: var(--er);
      background:rgba(6,8,16,.92);
      border:1px solid rgba(0,229,255,.15); border-right:3px solid var(--c1);
      padding:clamp(4px,.7vh,8px) clamp(7px,1vw,12px);
      min-width:clamp(90px,13vw,175px); max-width:clamp(100px,15vw,195px);
    }
    #scoreboard h3  { font-size:clamp(6px,.8vh,8px); color:var(--c1); letter-spacing:2px; margin-bottom:clamp(3px,.4vh,6px); font-family:'Rajdhani',sans-serif; }
    .sb-row  { display:flex; justify-content:space-between; align-items:center; margin-bottom:3px; gap:5px; }
    .sb-dot  { width:6px; height:6px; flex-shrink:0; }
    .sb-name { font-size:clamp(7px,.85vh,9px); flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .sb-kills{ font-size:clamp(8px,1.2vh,11px); font-weight:700; color:var(--c2); font-family:'Rajdhani',sans-serif; }

    /* ── Kill feed — top-center ── */
    #kill-feed {
      position:absolute;
      top: var(--et);
      left:50%; transform:translateX(-50%);
      display:flex; flex-direction:column; align-items:center; gap:3px;
      max-width:clamp(140px,28vw,270px); pointer-events:none;
    }
    .kf-entry {
      background:rgba(6,8,16,.92); border:1px solid #1a2040; border-left:3px solid;
      padding:3px clamp(5px,.8vw,10px); font-size:clamp(7px,.8vh,9px); white-space:nowrap;
      animation:kfIn 3s forwards;
    }
    @keyframes kfIn {
      0%   { opacity:0; transform:translateY(-6px); }
      10%  { opacity:1; transform:none; }
      70%  { opacity:1; }
      100% { opacity:0; }
    }

    /* ── Health/Ammo — bottom-left (desktop) ── */
    #hud-bl {
      position:absolute;
      bottom: var(--eb);
      left:   var(--el);
      background:linear-gradient(135deg,rgba(6,8,16,.95),rgba(10,14,28,.9));
      border:1px solid rgba(0,229,255,.2); border-left:3px solid var(--c1);
      padding:clamp(6px,1vh,12px) clamp(8px,1.1vw,14px);
      min-width:clamp(110px,16vw,185px);
    }
    .hud-lbl    { font-size:clamp(6px,.8vh,8px); color:#444; letter-spacing:2px; margin-bottom:2px; }
    #hp-bar     { width:clamp(80px,12vw,150px); height:7px; background:#0a0c18; border:1px solid #1a2040; margin-bottom:3px; position:relative; overflow:hidden; }
    #hp-fill    { height:100%; transition:width .12s, background .3s; }
    #hp-fill::after { content:''; position:absolute; inset:0 0 60% 0; background:rgba(255,255,255,.2); }
    #hp-val     { font-size:clamp(12px,2vh,18px); font-weight:700; margin-bottom:4px; font-family:'Rajdhani',sans-serif; }
    #ammo-val   { font-size:clamp(14px,2.4vh,21px); font-weight:700; font-family:'Rajdhani',sans-serif; color:var(--c1); }
    #ammo-max   { font-size:clamp(7px,.9vh,9px); color:#444; }
    #weapon-name{ font-size:clamp(6px,.8vh,8px); color:#888; margin-top:2px; letter-spacing:2px; }

    /* ── Character panel — bottom-right (desktop) ── */
    #hud-br {
      position:absolute;
      bottom: var(--eb);
      right:  var(--er);
      background:rgba(6,8,16,.88); border:1px solid rgba(255,255,255,.06);
      padding:clamp(5px,.8vh,9px) clamp(7px,1.1vw,13px); text-align:right;
    }
    #char-name { font-size:clamp(10px,1.4vh,13px); font-weight:700; font-family:'Rajdhani',sans-serif; letter-spacing:2px; }
    #char-role { font-size:clamp(6px,.8vh,8px); color:#666; letter-spacing:2px; }
    #ping-val  { font-size:clamp(6px,.8vh,8px); color:#444; margin-top:3px; }

    /* ── Reload bar ── */
    #reload-wrap {
      position:absolute; bottom:clamp(52px,8vh,72px); left:50%; transform:translateX(-50%);
      display:none; flex-direction:column; align-items:center; gap:3px;
    }
    #reload-lbl   { font-size:clamp(7px,.8vh,9px); color:var(--c2); letter-spacing:2px; }
    #reload-outer { width:clamp(80px,11vw,125px); height:4px; background:#0a0c18; border:1px solid #1a2040; }
    #reload-inner { height:100%; width:0%; background:var(--c2); transition:width .05s; }

    /* ── Desktop controls hint ── */
    #controls-hint {
      position:absolute; bottom:clamp(5px,.9vh,11px); left:50%; transform:translateX(-50%);
      font-size:8px; color:#2a2a3a; letter-spacing:2px;
      font-family:'Share Tech Mono',monospace; white-space:nowrap;
    }

    /* ── Death screen ── */
    #death-screen {
      display:none; position:fixed; inset:0;
      background:radial-gradient(ellipse at center,rgba(180,0,0,.25),rgba(0,0,0,.6));
      z-index:25; align-items:center; justify-content:center; flex-direction:column; gap:10px;
    }
    #death-screen.vis { display:flex; }
    #death-screen h2 { font-size:clamp(18px,5vw,36px); font-weight:700; color:#ff1744; letter-spacing:6px; text-shadow:0 0 30px #ff1744; font-family:'Rajdhani',sans-serif; }
    #death-screen p  { font-size:clamp(8px,1.2vw,11px); color:#888; letter-spacing:3px; font-family:'Share Tech Mono',monospace; }
    #respawn-cd      { font-size:clamp(26px,7vw,52px); color:var(--c2); font-family:'Rajdhani',sans-serif; font-weight:700; }

    /* ── Game over ── */
    #game-over {
      display:none; position:fixed; inset:0;
      background:rgba(0,0,0,.92); z-index:50;
      align-items:center; justify-content:center; flex-direction:column; gap:16px;
    }
    #game-over.vis { display:flex; }
    #go-title { font-size:clamp(20px,6vw,48px); font-weight:700; letter-spacing:6px; font-family:'Rajdhani',sans-serif; text-shadow:0 0 30px currentColor; }
    #go-sub   { font-size:clamp(8px,1.3vw,11px); color:#666; letter-spacing:4px; font-family:'Share Tech Mono',monospace; }
    #btn-new  {
      background:linear-gradient(135deg,var(--c1),#0088aa); color:#000; border:none;
      font-family:'Rajdhani',sans-serif; font-weight:700; font-size:clamp(11px,1.5vw,15px);
      padding:11px 32px; cursor:pointer; letter-spacing:3px; pointer-events:all;
      clip-path:polygon(8px 0%,100% 0%,calc(100% - 8px) 100%,0% 100%); transition:all .15s;
    }
    #btn-new:hover { background:linear-gradient(135deg,var(--c2),#aa3300); }

    /* ── Pointer-lock overlay ── */
    #click-to-play {
      display:none; position:fixed; inset:0; z-index:30;
      background:rgba(0,0,0,.75);
      align-items:center; justify-content:center; flex-direction:column; gap:12px; cursor:pointer;
    }
    #click-to-play.vis { display:flex; }
    #click-to-play h2  { font-size:clamp(14px,3.5vw,26px); font-weight:700; letter-spacing:4px; color:var(--c1); font-family:'Rajdhani',sans-serif; }
    #click-to-play p   { font-size:clamp(8px,1.2vw,10px); color:#888; letter-spacing:2px; font-family:'Share Tech Mono',monospace; }

    /* ── Damage flash ── */
    #dmg-flash { position:fixed; inset:0; background:rgba(255,0,0,0); pointer-events:none; z-index:35; transition:background .05s; }

    /* ══════════════════════════════════════════════
       MINIMAP
       Desktop: bottom-right, above char panel
       Mobile:  below kill-counter top-left (overridden)
    ══════════════════════════════════════════════ */
    #minimap {
      display:none; position:fixed; pointer-events:none; z-index:14;
      image-rendering:pixelated; border-radius:50%;
      border:2px solid rgba(0,229,255,.35);
      box-shadow:0 0 14px rgba(0,229,255,.18), inset 0 0 8px rgba(0,0,0,.6);
      /* Desktop: bottom-right above char info */
      width: clamp(96px,11vmin,140px);
      height:clamp(96px,11vmin,140px);
      bottom:calc(var(--eb) + clamp(72px,10vh,96px));
      right: var(--er);
    }
    #minimap.active { display:block; }

    /* ══════════════════════════════════════════════
       SOUND TOGGLE
       Floats top-center on desktop.
       On mobile moves to top-left inline with kill counter.
    ══════════════════════════════════════════════ */
    #sound-toggle {
      position:fixed; z-index:20; pointer-events:all; touch-action:manipulation;
      top:  calc(var(--sat) + clamp(4px,.7vh,8px));
      left: 50%; transform:translateX(-50%);
      background:rgba(6,8,16,.85); border:1px solid rgba(0,229,255,.25); color:var(--c1);
      font-size:clamp(11px,1.7vh,15px);
      width: clamp(26px,3.8vh,34px); height:clamp(26px,3.8vh,34px);
      border-radius:50%; cursor:pointer;
      display:none; align-items:center; justify-content:center;
      transition:background .15s;
    }
    #sound-toggle.active { display:flex; }
    #sound-toggle:active { background:rgba(0,229,255,.15); }

    /* ══════════════════════════════════════════════
       ROTATE OVERLAY
    ══════════════════════════════════════════════ */
    #rotate-overlay {
      display:none; position:fixed; inset:0; z-index:9999;
      background:radial-gradient(ellipse at 50% 50%,#0a1628,#060810);
      flex-direction:column; align-items:center; justify-content:center;
      gap:16px; text-align:center; padding:24px;
    }
    #rotate-overlay.show { display:flex; }
    .rot-icon {
      width:58px; height:58px; border:3px solid var(--c1); border-radius:12px;
      position:relative; animation:rotPhone 2s ease-in-out infinite;
      box-shadow:0 0 22px rgba(0,229,255,.4);
    }
    .rot-icon::before { content:''; position:absolute; inset:8px; background:rgba(0,229,255,.15); border-radius:5px; }
    .rot-icon::after  { content:'↻'; position:absolute; bottom:-24px; left:50%; transform:translateX(-50%); font-size:16px; color:var(--c1); }
    @keyframes rotPhone { 0%,100%{transform:rotate(0deg)} 40%,60%{transform:rotate(90deg)} }
    #rotate-overlay h2 { font-family:'Rajdhani',sans-serif; font-size:clamp(15px,5vw,24px); font-weight:700; color:var(--c1); letter-spacing:3px; margin-top:10px; }
    #rotate-overlay p  { font-family:'Share Tech Mono',monospace; font-size:clamp(9px,2.5vw,11px); color:#667; letter-spacing:2px; max-width:260px; line-height:1.6; }

    /* ══════════════════════════════════════════════
       TOUCH CONTROLS  (hidden on desktop)
    ══════════════════════════════════════════════ */
    #touch-controls { display:none; position:fixed; inset:0; z-index:12; pointer-events:none; }
    #touch-controls.active { display:block; }

    /* ── Joystick — bottom-left ── */
    #joystick-zone {
      position:absolute;
      bottom:calc(var(--sab) + clamp(8px,1.6vh,18px));
      left:  calc(var(--sal) + clamp(8px,1.4vw,16px));
      width: var(--joy-sz); height:var(--joy-sz);
      pointer-events:all; touch-action:none;
    }
    #joystick-base {
      position:absolute; inset:0; border-radius:50%;
      background:rgba(0,229,255,.07); border:2px solid rgba(0,229,255,.28);
      box-shadow:inset 0 0 14px rgba(0,229,255,.07);
    }
    #joystick-knob {
      position:absolute; border-radius:50%;
      width:var(--joy-knob); height:var(--joy-knob);
      top:50%; left:50%; transform:translate(-50%,-50%);
      background:radial-gradient(circle at 35% 35%,rgba(0,229,255,.55),rgba(0,229,255,.22));
      border:2px solid rgba(0,229,255,.75); box-shadow:0 0 10px rgba(0,229,255,.38);
    }
    #joystick-label {
      position:absolute; bottom:calc(-1*clamp(11px,1.8vh,15px));
      left:50%; transform:translateX(-50%);
      font-size:clamp(6px,.8vh,8px); color:rgba(0,229,255,.4);
      font-family:'Share Tech Mono',monospace; letter-spacing:2px; white-space:nowrap;
    }

    /* ── Aim zone — right 58%, full height minus button row ── */
    #aim-zone {
      position:absolute;
      top:0; left:42%; right:0;
      bottom:calc(var(--sab) + var(--fire-sz) + clamp(14px,2.6vh,30px));
      pointer-events:all; touch-action:none;
    }
    #aim-zone::after {
      content:'AIM'; position:absolute; top:8px; right:10px;
      font-size:7px; color:rgba(255,255,255,.07);
      font-family:'Share Tech Mono',monospace; letter-spacing:3px;
    }

    /* ══════════════════════════════════════════════
       ACTION BUTTONS
       Layout (right side, bottom-up):
         [ JUMP  ]          <- above FIRE
         [ FIRE  ] [RELOAD] <- bottom row
       FIRE  = bottom-right corner
       RELOAD = left of FIRE, vertically centered
       JUMP   = directly above FIRE
    ══════════════════════════════════════════════ */

    /* FIRE */
    #btn-shoot {
      position:absolute;
      bottom:var(--eb); right:var(--er);
      width:var(--fire-sz); height:var(--fire-sz); border-radius:50%;
      background:radial-gradient(circle at 35% 30%,rgba(255,107,53,.52),rgba(255,50,0,.26));
      border:2.5px solid rgba(255,107,53,.88); box-shadow:0 0 14px rgba(255,107,53,.28);
      display:flex; align-items:center; justify-content:center;
      pointer-events:all; touch-action:none;
      -webkit-tap-highlight-color:transparent; cursor:pointer;
      transition:background .06s, box-shadow .06s;
    }
    #btn-shoot span { font-family:'Rajdhani',sans-serif; font-weight:700; font-size:clamp(10px,1.5vh,13px); color:#ff6b35; letter-spacing:1px; }
    #btn-shoot.pressed {
      background:radial-gradient(circle at 35% 30%,rgba(255,107,53,.9),rgba(255,50,0,.65));
      box-shadow:0 0 24px rgba(255,107,53,.75);
    }

    /* RELOAD — vertically centered with FIRE, to its left */
    #btn-reload-mobile {
      position:absolute;
      bottom:calc(var(--eb) + (var(--fire-sz) - var(--reload-sz)) / 2);
      right:calc(var(--er) + var(--fire-sz) + clamp(8px,1.2vw,14px));
      width:var(--reload-sz); height:var(--reload-sz); border-radius:50%;
      background:rgba(255,235,59,.10); border:2px solid rgba(255,235,59,.55);
      box-shadow:0 0 8px rgba(255,235,59,.14);
      display:flex; align-items:center; justify-content:center; flex-direction:column; gap:1px;
      pointer-events:all; touch-action:none;
      -webkit-tap-highlight-color:transparent; cursor:pointer;
      transition:background .08s;
    }
    #btn-reload-mobile span  { font-family:'Rajdhani',sans-serif; font-size:clamp(8px,1.1vh,10px); color:#ffeb3b; letter-spacing:1px; line-height:1; }
    #btn-reload-mobile .ri   { font-size:clamp(11px,1.8vh,15px); line-height:1; }
    #btn-reload-mobile.pressed { background:rgba(255,235,59,.26); box-shadow:0 0 16px rgba(255,235,59,.42); }

    /* JUMP — directly above FIRE */
    #btn-jump-mobile {
      position:absolute;
      bottom:calc(var(--eb) + var(--fire-sz) + clamp(6px,1.1vh,12px));
      right:calc(var(--er) + (var(--fire-sz) - var(--jump-sz)) / 2);
      width:var(--jump-sz); height:var(--jump-sz); border-radius:50%;
      background:rgba(181,255,77,.10); border:2px solid rgba(181,255,77,.42);
      display:flex; align-items:center; justify-content:center;
      pointer-events:all; touch-action:none;
      -webkit-tap-highlight-color:transparent; cursor:pointer;
      transition:background .08s;
    }
    #btn-jump-mobile span   { font-family:'Rajdhani',sans-serif; font-size:clamp(8px,1.1vh,10px); color:#b5ff4d; letter-spacing:1px; }
    #btn-jump-mobile.pressed { background:rgba(181,255,77,.26); }

    /* ══════════════════════════════════════════════
       MOBILE HUD OVERRIDES
       Applied on any touch (coarse-pointer) device
       in landscape. Repositions every panel so
       nothing overlaps the joystick or buttons.

       ZONES (all measurements from screen edge):
         TOP-LEFT    : Kill counter  (stays put, small)
         TOP-CENTER  : Kill feed     (stays put)
         TOP-RIGHT   : Scoreboard   (stays put, narrower)
         LEFT CENTER : Health/Ammo  — moved RIGHT of joystick,
                       positioned at vertical center-ish
         RIGHT-CENTER: Minimap      — below scoreboard, top-right
         BOTTOM-LEFT : Joystick     (unchanged)
         BOTTOM-RIGHT: Fire/Reload/Jump (unchanged)
         BOTTOM-CENTER: Char info   — moved center-bottom,
                        between joystick and buttons
         TOP-LEFT+   : Sound toggle — right of kill counter
    ══════════════════════════════════════════════ */
    @media (pointer:coarse) and (orientation:landscape) {

      /* ── Kill counter: stays top-left, just smaller ── */
      #kills-display {
        top:  var(--et);
        left: var(--el);
        padding: clamp(3px,.6vh,6px) clamp(6px,.9vw,10px);
      }
      #kills-val  { font-size:clamp(14px,2.4vh,20px); }
      #kills-lbl,
      #kills-goal { font-size:clamp(5px,.7vh,7px); }

      /* ── Sound toggle: top-left, right of kill counter ──
         We use left:auto and position it next to kills */
      #sound-toggle {
        top:  var(--et);
        left: auto;
        /* pushed right of kill-counter (~60px wide) */
        margin-left: 0;
        transform: none;
        right: auto;
        /* We'll position it with JS — keep it top-center on mobile but smaller */
        left: 50%;
        transform: translateX(-50%);
        width:  clamp(24px,3.5vh,30px);
        height: clamp(24px,3.5vh,30px);
        font-size: clamp(10px,1.5vh,13px);
      }

      /* ── Scoreboard: top-right, narrower ── */
      #scoreboard {
        top:   var(--et);
        right: var(--er);
        min-width:clamp(82px,11vw,140px);
        max-width:clamp(90px,13vw,155px);
        padding: clamp(3px,.6vh,6px) clamp(5px,.8vw,10px);
      }
      #scoreboard h3 { font-size:clamp(5px,.7vh,7px); margin-bottom:2px; }
      .sb-name  { font-size:clamp(6px,.8vh,8px); }
      .sb-kills { font-size:clamp(7px,1vh,10px); }

      /* ── Kill feed: top-center, tight ── */
      #kill-feed {
        top: var(--et);
        max-width:clamp(120px,24vw,220px);
      }
      .kf-entry { font-size:clamp(6px,.75vh,8px); padding:2px 7px; }

      /* ── Health/Ammo: RIGHT of joystick, vertically centered ──
         joystick sits at bottom: eb, left: el, height: joy-sz
         So panel sits: bottom = eb + joy-sz/2 - panelHeight/2
         We approximate with bottom: eb + 12px and let it grow up.
      ── */
      #hud-bl {
        left:  calc(var(--el) + var(--joy-sz) + clamp(9px,1.5vw,14px));
        bottom:calc(var(--sab) + clamp(6px,1.2vh,12px));
        min-width: unset;
        max-width: clamp(115px,18vw,155px);
        padding: clamp(5px,.8vh,8px) clamp(7px,1vw,11px);
      }
      #hp-bar   { width:clamp(70px,10vw,120px); height:5px; }
      #hp-val   { font-size:clamp(11px,1.8vh,16px); margin-bottom:3px; }
      #ammo-val { font-size:clamp(13px,2.1vh,18px); }
      #ammo-max { font-size:clamp(6px,.8vh,8px); }
      #weapon-name { font-size:clamp(5px,.7vh,7px); }

      /* ── Character info: bottom-center ──
         Sits between joystick area and button area.
         left: after health panel, right: before reload button
      ── */
      #hud-br {
        left:  50%;
        transform: translateX(-50%);
        right: auto;
        bottom: calc(var(--sab) + clamp(6px,1.2vh,12px));
        text-align: center;
        padding: clamp(4px,.6vh,6px) clamp(8px,1.2vw,12px);
        max-width: clamp(90px,15vw,135px);
        /* hide ping to save space */
      }
      #char-name { font-size:clamp(9px,1.3vh,12px); letter-spacing:1px; }
      #char-role { font-size:clamp(5px,.7vh,7px); }
      #ping-val  { display:none; }

      /* ── Minimap: top-right, below scoreboard ──
         scoreboard is ~clamp(44px,8vh,64px) tall from top
      ── */
      #minimap {
        top:   calc(var(--et) + clamp(40px,7.5vh,62px));
        right: var(--er);
        bottom: auto;
        width:  clamp(70px,11vmin,100px);
        height: clamp(70px,11vmin,100px);
      }

      /* ── Reload bar: above buttons ── */
      #reload-wrap {
        bottom: calc(var(--sab) + var(--fire-sz) + clamp(18px,3.5vh,36px));
      }

      /* Hide desktop hint */
      #controls-hint { display:none; }
    }

    /* ══════════════════════════════════════════════
       TINY LANDSCAPE PHONES  (iPhone SE etc, <440px tall)
    ══════════════════════════════════════════════ */
    @media (pointer:coarse) and (orientation:landscape) and (max-height:440px) {

      :root {
        --fire-sz:   clamp(50px,8.5vh,64px);
        --reload-sz: clamp(38px,6.5vh,52px);
        --jump-sz:   clamp(34px,5.8vh,46px);
        --joy-sz:    clamp(100px,17vh,128px);
        --joy-knob:  clamp(36px, 6vh, 48px);
      }

      /* Lobby */
      #lobby-inner  { padding:2px 7px; }
      .logo         { font-size:clamp(14px,3.5vh,20px); letter-spacing:2px; }
      .logo-sub     { margin-bottom:3px; font-size:6px; }
      #name-input   { padding:4px 10px; margin-bottom:4px; font-size:9px; }
      .char-grid    { gap:2px; margin-bottom:3px; }
      .char-card    { padding:2px 2px; }
      .char-swatch  { width:15px; height:15px; margin-bottom:1px; }
      .stat-row     { margin-bottom:0; }
      #btn-play     { font-size:10px; padding:5px 16px; }

      /* HUD compacted */
      #kills-val { font-size:clamp(12px,2vh,16px); }
      #hud-bl    { max-width:clamp(95px,15vw,128px); }
    }

  </style>
</head>
<body>

<!-- ══ LOBBY ══════════════════════════════════════ -->
<div id="lobby">
  <div class="lobby-grid-bg"></div>
  <div id="lobby-inner">
    <div class="logo">CE STRIKE</div>
    <div class="logo-sub">3D MULTIPLAYER TACTICAL SHOOTER</div>
    <input id="name-input" type="text" placeholder="ENTER CALLSIGN" maxlength="16" autocomplete="off"/>
    <div class="char-grid" id="char-grid"></div>
    <button id="btn-play" disabled>&#9654; DEPLOY</button>
  </div>
</div>

<!-- ══ GAME CANVAS ════════════════════════════════ -->
<canvas id="cvs"></canvas>

<!-- ══ CROSSHAIR ══════════════════════════════════ -->
<div id="crosshair"><div class="ch-dot"></div></div>

<!-- ══ SOUND TOGGLE ═══════════════════════════════ -->
<button id="sound-toggle" onclick="toggleSound()" title="Toggle Sound">&#128266;</button>

<!-- ══ HUD ════════════════════════════════════════ -->
<div id="hud">

  <div id="kills-display">
    <div id="kills-val">0</div>
    <div id="kills-lbl">KILLS</div>
    <div id="kills-goal">GOAL: 15</div>
  </div>

  <div id="scoreboard">
    <h3>&#9672; SCOREBOARD</h3>
    <div id="sb-rows"></div>
  </div>

  <div id="kill-feed"></div>

  <div id="hud-bl">
    <div class="hud-lbl">HEALTH</div>
    <div id="hp-bar"><div id="hp-fill" style="width:100%;background:#00e676"></div></div>
    <div id="hp-val">100</div>
    <div class="hud-lbl">AMMO</div>
    <div id="ammo-val">--</div>
    <div id="ammo-max">/ --</div>
    <div id="weapon-name">---</div>
  </div>

  <div id="hud-br">
    <div id="char-name">---</div>
    <div id="char-role">---</div>
    <div id="ping-val">PING: --</div>
  </div>

  <div id="reload-wrap">
    <div id="reload-lbl">RELOADING</div>
    <div id="reload-outer"><div id="reload-inner"></div></div>
  </div>

  <div id="controls-hint">WASD &#183; MOVE &nbsp;|&nbsp; MOUSE &#183; AIM &nbsp;|&nbsp; LMB &#183; SHOOT &nbsp;|&nbsp; SPACE &#183; JUMP &nbsp;|&nbsp; R &#183; RELOAD &nbsp;|&nbsp; ESC &#183; RELEASE</div>

  <div id="death-screen">
    <h2>ELIMINATED</h2>
    <p>RESPAWNING IN</p>
    <div id="respawn-cd">3</div>
  </div>

</div><!-- #hud -->

<!-- ══ POINTER-LOCK OVERLAY ══════════════════════ -->
<div id="click-to-play" class="vis">
  <h2>CLICK TO PLAY</h2>
  <p>MOUSE WILL BE CAPTURED &#183; ESC TO RELEASE</p>
</div>

<!-- ══ GAME OVER ══════════════════════════════════ -->
<div id="game-over">
  <div id="go-title">MATCH OVER</div>
  <div id="go-sub">---</div>
  <button id="btn-new">&#9654; NEW MATCH</button>
</div>

<!-- ══ MINIMAP ════════════════════════════════════ -->
<canvas id="minimap" width="160" height="160"></canvas>

<!-- ══ DAMAGE FLASH ═══════════════════════════════ -->
<div id="dmg-flash"></div>

<!-- ══ ROTATE OVERLAY ════════════════════════════ -->
<div id="rotate-overlay">
  <div class="rot-icon"></div>
  <h2>ROTATE YOUR DEVICE</h2>
  <p>Please rotate to landscape mode to play CE Strike.</p>
</div>

<!-- ══ TOUCH CONTROLS ════════════════════════════ -->
<div id="touch-controls">

  <!-- LEFT: Virtual joystick -->
  <div id="joystick-zone">
    <div id="joystick-base"></div>
    <div id="joystick-knob"></div>
    <div id="joystick-label">MOVE</div>
  </div>

  <!-- RIGHT: Transparent drag-to-aim area -->
  <div id="aim-zone"></div>

  <!-- Action buttons (right side) -->
  <div id="btn-shoot"><span>FIRE</span></div>
  <div id="btn-reload-mobile"><span class="ri">&#8634;</span><span>RELOAD</span></div>
  <div id="btn-jump-mobile"><span>JUMP</span></div>

</div><!-- #touch-controls -->

<!-- ══ SCRIPTS ════════════════════════════════════ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="client.js"></script>

</body>
</html>
